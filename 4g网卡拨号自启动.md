## 0.前置条件
参考[文档](https://doc.embedfire.com/linux/rk356x/quick_start/zh/latest/quick_start/wireless/4g/4g.html#id9)。这部分自启动服务写的有点问题，做一下修改。

先看网卡模式和sim卡是否正确
```
#在后台显示/dev/ttyUSB2返回的信息(如果想退出后台显示,使用后面的命令：pkill cat)
cat /dev/ttyUSB2 &

#检查sim卡的状态
echo -e "AT+CPIN?\r\n" >  /dev/ttyUSB2

#如果返回值为如下即为获取sim卡成功
+CPIN: READY

OK



#查询当前网卡的模式
echo -e "AT+QCFG=\"usbnet\"\r\n" >  /dev/ttyUSB2
#例子:
root@lubancat:~# cat /dev/ttyUSB2 &
[1] 1155
root@lubancat:~# echo -e "AT+QCFG=\"usbnet\"\r\n" >  /dev/ttyUSB2
root@lubancat:~#
+QCFG: "usbnet",0

#解析
可以看到返回了0，这样就能用下面的脚本拨号了，如果不是0，可以用下面的命令设置。

echo -e "AT+QCFG=\"usbnet\",0\r\n" >  /dev/ttyUSB2
#重启模块（重启模块才能生效）
echo -e "AT+CFUN=1,1\r\n" >  /dev/ttyUSB2
```



## 1.步骤

### 1.1 配置环境，下载脚本
```
#更新软件
sudo apt update

#获取依赖软件
sudo apt install make gcc git busybox udhcpc

#wget下载编译好的quectel-CM至/usr/bin/目录下
sudo wget -O /usr/bin/quectel-CM https://cloud.embedfire.com/software/packages/quectel-CM

#添加执行权限
sudo chmod 777 /usr/bin/quectel-CM
```

### 2.1 配置自启动服务

#### 2.1.1 在`/opt`目录创建自启动脚本：
`sudo vi /opt/auto_4G.sh`,脚本里添加如下内容，3gnet是APN，根据自己手机卡运营商决定。
```
#注意不要加&，否则可能自启动失败

#!/bin/bash
sudo quectel-CM -s 3gnet
```
添加执行权限：`sudo chmod 0755 /opt/auto_4G.sh`
#### 2.1.2 创建配置文件

在`/etc/systemd/system/`目录下创建一个`auto_4G.service`配置文件：

`sudo vi /etc/systemd/system/auto_4G.service`

添加如下内容：
```
[Unit]
Description = auto_4G daemon

[Service]
ExecStart = /opt/auto_4G.sh
Restart = on-failure
RestartSec=3
Type = simple

[Install]
WantedBy = multi-user.target
```
使能auto_4G.service服务
```shell
sudo systemctl enable auto_4G
sudo systemctl start auto_4G
```

然后重启，应该就会自动拨号了
